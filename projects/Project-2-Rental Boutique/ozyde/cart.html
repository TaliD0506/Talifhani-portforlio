<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Cart — OZYDE</title>
    <style>
         :root {
            --bg: #fff;
            --nav-bg: #0b0b0b;
            --muted: #9a9a9a;
            --accent: #111;
            --max-width: 1200px;
        }
        
        * {
            box-sizing: border-box
        }
        
        body {
            margin: 0;
            font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
            color: #111;
            background: var(--bg)
        }
        
        .nav-wrap {
            background: var(--nav-bg);
            color: #fff;
            position: sticky;
            top: 0;
            z-index: 120;
            box-shadow: 0 6px 20px rgba(2, 2, 2, 0.12)
        }
        
        .nav {
            max-width: var(--max-width);
            margin: 0 auto;
            padding: 10px 18px;
            display: flex;
            align-items: center;
            gap: 18px;
            justify-content: space-between
        }
        
        .logo {
            display: flex;
            gap: 12px;
            align-items: center;
            font-weight: 800;
            letter-spacing: 1px;
            font-size: 20px
        }
        
        .logo-badge {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: linear-gradient(135deg, #fff2, #fff6);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #111;
            font-weight: 900;
            font-size: 16px
        }
        
        .search {
            flex: 1;
            max-width: 640px;
            display: flex;
            align-items: center;
            gap: 6px;
            margin: 0 12px
        }
        
        .search input {
            width: 100%;
            padding: 10px 12px;
            border-radius: 999px 0 0 999px;
            border: 0;
            outline: 0;
            font-size: 14px;
            background: rgba(255, 255, 255, 0.06);
            color: #fff
        }
        
        .search button {
            padding: 10px 12px;
            border-radius: 0 999px 999px 0;
            border: 0;
            background: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center
        }
        
        .icons {
            display: flex;
            gap: 14px;
            align-items: center
        }
        
        .icon-only {
            display: inline-flex;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: 0;
            color: #fff;
            cursor: pointer
        }
        
        .profile-avatar {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: linear-gradient(135deg, #222, #111);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700
        }
        
        .profile-area {
            position: relative
        }
        
        .profile-btn {
            display: flex;
            gap: 10px;
            align-items: center;
            background: transparent;
            border: 0;
            color: #fff;
            cursor: pointer;
            padding: 6px 8px;
            border-radius: 8px
        }
        
        .dropdown {
            position: absolute;
            right: 0;
            top: calc(100% + 10px);
            background: #111;
            border-radius: 10px;
            padding: 8px 6px;
            min-width: 180px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: none
        }
        
        .dropdown a {
            display: block;
            color: #fff;
            padding: 10px 12px;
            text-decoration: none;
            font-size: 14px;
            border-radius: 8px
        }
        
        .dropdown a:hover {
            background: #1a1a1a
        }
        
        .mobile-toggle {
            display: none;
            background: transparent;
            border: 0;
            color: #fff
        }
        
        .mobile-menu {
            display: none;
            padding: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.03)
        }
        
        @media (max-width:880px) {
            .search {
                display: none
            }
            .mobile-toggle {
                display: inline-flex
            }
        }
        
        main {
            max-width: var(--max-width);
            margin: 28px auto;
            padding: 0 18px 60px
        }
        
        .topline {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px
        }
        
        .back-btn {
            background: #fff;
            border: 0;
            padding: 8px 10px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700
        }
        
        h1 {
            margin: 0
        }
        
        .muted {
            color: var(--muted)
        }
        
        .layout {
            display: grid;
            grid-template-columns: 1fr 360px;
            gap: 18px;
            margin-top: 18px
        }
        
        @media (max-width:980px) {
            .layout {
                grid-template-columns: 1fr
            }
        }
        
        .cart-item {
            background: #fff;
            padding: 12px;
            border-radius: 10px;
            border: 1px solid #eee;
            display: flex;
            gap: 12px;
            align-items: center
        }
        
        .thumb {
            width: 110px;
            height: 110px;
            border-radius: 8px;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #aaa
        }
        
        .title {
            font-weight: 700
        }
        
        .meta {
            font-size: 13px;
            color: var(--muted)
        }
        
        .qty {
            display: flex;
            gap: 6px;
            align-items: center
        }
        
        .qty button {
            padding: 6px 8px;
            border-radius: 6px;
            border: 1px solid #eee;
            background: #fff;
            cursor: pointer
      
        }

          .qty button:disabled {
       opacity: 0.4;
       cursor: not-allowed;
}

        
        .summary {
            background: #fff;
            padding: 18px;
            border-radius: 12px;
            border: 1px solid #eee
        }
        
        .total-row {
            display: flex;
            justify-content: space-between;
            font-weight: 800;
            margin-top: 12px
        }
        
        .btn {
            padding: 10px 12px;
            border-radius: 8px;
            border: 0;
            cursor: pointer
        }
        
        .btn.primary {
            background: var(--accent);
            color: #fff
        }
        
        .btn.ghost {
            background: #fff;
            border: 1px solid rgba(0, 0, 0, 0.06)
        }
    </style>
</head>

<body>
    <!-- NAVBAR -->
    <header class="nav-wrap" role="banner">
        <div class="nav" role="navigation" aria-label="Main navigation">
            <div style="display:flex;align-items:center;gap:12px">
                <div class="logo" id="brandLink" style="cursor:pointer">
                    <div class="logo-badge" aria-hidden="true">OZ</div>
                    <div>OZYDE</div>
                </div>
            </div>

            <div class="search" role="search" aria-label="Site search">
                <input id="searchInput" type="search" placeholder="Search dresses, designers, collection..." aria-label="Search">
                <button id="searchBtn" aria-label="Search">
          <svg viewBox="0 0 24 24" width="16" height="16" fill="none"><path d="M21 21l-4.35-4.35" stroke="#111" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><circle cx="11" cy="11" r="6" stroke="#111" stroke-width="2"/></svg>
        </button>
            </div>

            <div class="icons" role="group" aria-label="User actions">
                <button class="icon-only" title="Wishlist" aria-label="Wishlist" id="topWishlistBtn">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M20.8 7.2a5 5 0 0 0-7.07 0L12 8.94l-1.73-1.72a5 5 0 1 0-7.07 7.07L12 21.5l8.8-8.8a5 5 0 0 0 0-7.5z" stroke="white" stroke-width="1.2" fill="none"/></svg>
        </button>

                <button class="icon-only" title="Cart" aria-label="Cart" id="topCartBtn">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M3 3h2l1 7h13" stroke="white" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><circle cx="10" cy="20" r="1.5" fill="white"/><circle cx="18" cy="20" r="1.5" fill="white"/></svg>
        </button>

                <div class="profile-area" id="profileArea">
                    <button class="profile-btn" id="profileBtn" aria-haspopup="true" aria-expanded="false" aria-label="Open account menu">
            <div class="profile-avatar" aria-hidden="true">A</div>
            <div style="text-align:left">
              <div style="font-weight:700; font-size:14px">A. Nomvula</div>
              <div style="font-size:12px; color:#bdbdbd;">Member</div>
            </div>
          </button>

                    <div class="dropdown" id="profileDropdown" role="menu" aria-hidden="true">
                        <a href="customerdashboard.html" role="menuitem">My Account</a>
                        <a href="orders.html" role="menuitem">My Orders</a>
                        <a href="wishlist.html" role="menuitem">Wishlist</a>
                        <a href="#" role="menuitem" id="signOutLink">Sign out</a>
                    </div>
                </div>

                <button class="mobile-toggle" id="mobileToggle" aria-expanded="false" aria-label="Open menu">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M3 7h18M3 12h18M3 17h18" stroke="white" stroke-width="1.6" stroke-linecap="round"/></svg>
        </button>
            </div>
        </div>

        <div class="mobile-menu" id="mobileMenu" aria-hidden="true">
            <div style="margin-bottom:10px">
                <input id="mobileSearch" type="search" placeholder="Search dresses..." style="width:100%; padding:10px 12px; border-radius:8px; border:0; background:rgba(255,255,255,0.04); color:#fff">
            </div>
            <div style="display:flex;gap:10px">
                <button class="icon-only" aria-label="Wishlist (mobile)" id="mWishlist"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M20.8 7.2a5 5 0 0 0-7.07 0L12 8.94l-1.73-1.72a5 5 0 1 0-7.07 7.07L12 21.5l8.8-8.8a5 5 0 0 0 0-7.5z" stroke="white" stroke-width="1.2" fill="none"/></svg></button>
                <button class="icon-only" aria-label="Cart (mobile)" id="mCart"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M3 3h2l1 7h13" stroke="white" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><circle cx="10" cy="20" r="1.5" fill="white"/><circle cx="18" cy="20" r="1.5" fill="white"/></svg></button>
                <button class="profile-btn" style="background:transparent;border:0;color:#fff" id="mAccountBtn">Account</button>
            </div>
        </div>
    </header>

    <main>
        <div class="topline">
            <button id="backBtn" class="back-btn" aria-label="Go back">← Back</button>
            <div>
                <h1>Cart</h1>
                <div class="muted">Review your items, change quantities or proceed to checkout.</div>
            </div>
        </div>

        <div class="layout" style="margin-top:18px">
            <div id="itemsCol"></div>

            <aside class="summary">
                <div style="font-weight:800">Order summary</div>
                <div style="margin-top:12px">
                    <div style="display:flex;justify-content:space-between">
                        <div>Subtotal</div>
                        <div id="subVal">R0.00</div>
                    </div>
                    <div style="display:flex;justify-content:space-between;margin-top:8px">
                        <div>Deposit (20%)</div>
                        <div id="depositVal">R0.00</div>
                    </div>
                    <div style="display:flex;justify-content:space-between;margin-top:8px">
                        <div>Delivery</div>
                        <div id="deliveryVal">R0.00</div>
                    </div>
                    <div class="total-row">
                        <div>Total</div>
                        <div id="totalVal">R0.00</div>
                    </div>
                </div>
                <div style="margin-top:16px;display:flex;gap:8px">
                    <button class="btn ghost" id="continueBtn">Continue shopping</button>
                    <button class="btn primary" id="checkoutBtn">Checkout</button>
                </div>
                <div class="muted" style="margin-top:12px;font-size:13px">Deposit refunded after inspection if items returned on time and undamaged.</div>
            </aside>
        </div>
    </main>

    <script>
        (function() {
            // navbar wiring
            const mt = document.getElementById('mobileToggle');
            const mm = document.getElementById('mobileMenu');
            mt && mt.addEventListener('click', () => {
                const open = mm.style.display === 'block';
                mm.style.display = open ? 'none' : 'block';
                mt.setAttribute('aria-expanded', String(!open));
                mm.setAttribute('aria-hidden', String(open));
            });

            const profileBtn = document.getElementById('profileBtn');
            const dropdown = document.getElementById('profileDropdown');
            const profileArea = document.getElementById('profileArea');

            profileBtn && profileBtn.addEventListener('click', () => {
                const visible = dropdown.style.display === 'block';
                dropdown.style.display = visible ? 'none' : 'block';
                dropdown.setAttribute('aria-hidden', String(visible));
                profileBtn.setAttribute('aria-expanded', String(!visible));
            });

            document.addEventListener('click', (e) => {
                if (!profileArea.contains(e.target)) {
                    dropdown.style.display = 'none';
                    dropdown.setAttribute('aria-hidden', 'true');
                    profileBtn && profileBtn.setAttribute('aria-expanded', 'false');
                }
            });

            document.getElementById('searchBtn').addEventListener('click', () => {
                const q = document.getElementById('searchInput').value.trim();
                if (!q) {
                    alert('Type something to search (demo)');
                    return;
                }
                window.location.href = `search.html?q=${encodeURIComponent(q)}`;
            });

            document.getElementById('topWishlistBtn').addEventListener('click', () => window.location.href = 'wishlist.html');
            document.getElementById('topCartBtn').addEventListener('click', () => window.location.href = 'cart.php');
            document.getElementById('mWishlist').addEventListener('click', () => window.location.href = 'wishlist.html');
            document.getElementById('mCart').addEventListener('click', () => window.location.href = 'cart.php');

            // BRAND: continue shopping target — goes to the logged-in navbar page you asked for
            document.getElementById('brandLink').addEventListener('click', () => window.location.href = 'loggedin-navbar.html');

            // sign out (demo)
            const signOut = document.getElementById('signOutLink');
            if (signOut) signOut.addEventListener('click', (e) => {
                e.preventDefault();
                if (!confirm('Sign out?')) return;
                window.location.href = 'index.html';
            });

            document.getElementById('mAccountBtn').addEventListener('click', () => window.location.href = 'profile.html');

            // back button
            document.getElementById('backBtn').addEventListener('click', () => {
                if (history.length > 1) history.back();
                else window.location.href = 'loggedin-navbar.html';
            });

            // cart demo
            const itemsCol = document.getElementById('itemsCol');
            const subVal = document.getElementById('subVal');
            const depositVal = document.getElementById('depositVal');
            const deliveryVal = document.getElementById('deliveryVal');
            const totalVal = document.getElementById('totalVal');

            async function fetchCart() {
    const resp = await fetch('get_cart.php');
const data = await resp.json();
const items = data.cart || [];
    return data.cart || [];
}


            function formatMoney(n) {
                return 'R' + Number(n).toLocaleString(undefined, {
                    minimumFractionDigits: 2
                })
            }

            function escapeHtml(s) {
                return String(s).replace(/[&<>"]/g, (c) => ({
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;'
                }[c]));
            }

            let cartItems = [];
fetchCart().then(items => {
    cartItems = items;
    renderCart(cartItems);
});

            function renderCart(items) {
    itemsCol.innerHTML = '';
    if (!items || items.length === 0) {
        itemsCol.innerHTML = '<div style="background:#fff;padding:30px;border-radius:12px;text-align:center">Your cart is empty</div>';
        updateSummary([]);
        return;
    }

    items.forEach(it => {
        const el = document.createElement('div');
        el.className = 'cart-item';
        const subtotal = it.price * it.quantity * it.days; // Correct subtotal calculation

        el.innerHTML = `
            <div class="thumb"><img src="${escapeHtml(it.image)}" alt="${escapeHtml(it.name)}" style="width:100%;height:100%;object-fit:cover;border-radius:8px"></div>

            </div>
            <div style="flex:1">
                <div class="title">${escapeHtml(it.name)}</div>
                <div class="meta">${it.days} days • R${Number(it.price).toFixed(2)}</div>
                <div style="margin-top:10px;display:flex;align-items:center;gap:12px">
                    <div class="qty" aria-label="Quantity controls">
                        <button data-op="dec">−</button>
                        <div style="min-width:26px;text-align:center">${it.quantity}</div>
                        <button data-op="inc">+</button>
                    </div>
                    <button class="btn ghost" data-action="remove">Remove</button>
                </div>
            </div>
            <div style="font-weight:800">${formatMoney(subtotal)}</div>
        `;

        const decBtn = el.querySelector('[data-op="dec"]');
        const incBtn = el.querySelector('[data-op="inc"]');
        const qtyDisplay = el.querySelector('.qty div');

        function updateQtyDisplay() {
            qtyDisplay.textContent = it.quantity;
            decBtn.disabled = it.quantity <= 1;
        }

        decBtn.addEventListener('click', async () => {
            if (it.quantity > 1) {
                it.quantity--;
                await updateCartItem(it.product_id, it.quantity);
                updateCartDisplay();
            }
        });

        incBtn.addEventListener('click', async () => {
            it.quantity++;
            await updateCartItem(it.product_id, it.quantity);
            updateCartDisplay();
        });

        updateQtyDisplay();

        // Remove item
        el.querySelector('[data-action="remove"]').addEventListener('click', async () => {
            if (!confirm('Remove item from cart?')) return;
            await removeCartItem(it.product_id);
            cartItems = cartItems.filter(x => x.product_id !== it.product_id);
            updateCartDisplay();
        });

        itemsCol.appendChild(el);
    });

    updateSummary(items);
}


           function updateSummary(items) {
    const subtotal = items.reduce((s, i) => s + (i.price * i.quantity * i.days), 0); // include days
    const deposit = subtotal * 0.20; // 20% deposit
    const delivery = items.length ? 150 : 0; // flat delivery fee if items exist
    const total = subtotal + deposit + delivery;

    subVal.textContent = formatMoney(subtotal);
    depositVal.textContent = formatMoney(deposit);
    deliveryVal.textContent = formatMoney(delivery);
    totalVal.textContent = formatMoney(total);
}


            

            // --- CHECKOUT ---
            document.getElementById('checkoutBtn').addEventListener('click', () => {
                if (!cartItems || cartItems.length === 0) {
                    alert('Your cart is empty. Add items before checking out.');
                    return;
                }
                // Pass cart to checkout page
                sessionStorage.setItem('ozyde_cart', JSON.stringify(cartItems));
                window.location.href = 'checkout.html';
            });

            // --- CONTINUE SHOPPING ---
            document.getElementById('continueBtn').addEventListener('click', () => {
                window.location.href = 'loggedin-navbar.html';
            });

        })();

        async function updateCartItem(productId, qty) {
    await fetch('get_cart.php?action=update', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: `product_id=${encodeURIComponent(productId)}&qty=${qty}`
    });
}

async function removeCartItem(productId) {
    await fetch('get_cart.php?action=remove', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: `product_id=${encodeURIComponent(productId)}`
    });
}

    </script>
</body>

</html>